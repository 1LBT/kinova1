<launch>
  <!--
    GGCNN抓取系统启动文件（带手眼标定）
    
    此launch文件启动完整的抓取系统，包括：
    1. 机械臂控制
    2. 相机驱动
    3. 手眼标定TF
    4. GGCNN抓取节点
    
    使用方法:
      roslaunch ggcnn_kinova_grasping ggcnn_grasp_with_calibration.launch
  -->

  <!-- 机械臂参数 -->
  <arg name="kinova_robotType" default="m1n6s200"/>
  <arg name="kinova_robotName" default="$(arg kinova_robotType)"/>
  
  <!-- 是否使用仿真 -->
  <arg name="use_gazebo" default="false"/>
  
  <!-- 是否启动RViz -->
  <arg name="use_rviz" default="true"/>

  <!-- ========== 1. 手眼标定TF发布 ========== -->
  <!-- 这是最重要的部分，发布从末端执行器到相机的变换 -->
  <include file="$(find ggcnn_kinova_grasping)/launch/handeye_static_tf.launch">
    <arg name="parent_frame" value="m1n6s200_end_effector"/>
    <arg name="child_frame" value="camera_link"/>
  </include>

  <!-- ========== 2. 相机驱动（如果使用真实相机） ========== -->
  <group unless="$(arg use_gazebo)">
    <include file="$(find ggcnn_kinova_grasping)/launch/wrist_camera.launch">
      <arg name="camera" value="camera"/>
    </include>
  </group>

  <!-- ========== 3. GGCNN抓取节点 ========== -->
  <!-- 
    注意：需要先启动GGCNN检测节点
    rosrun ggcnn_kinova_grasping run_ggcnn.py
  -->
  
  <!-- ========== 4. RViz可视化 ========== -->
  <node if="$(arg use_rviz)" name="rviz" pkg="rviz" type="rviz" 
        args="-d $(find ggcnn_kinova_grasping)/rviz/grasp_visualization.rviz" 
        required="false"/>

  <!-- ========== 信息输出 ========== -->
  <node pkg="rostopic" type="rostopic" name="tf_echo" 
        args="echo /tf" output="screen" required="false"/>

</launch>
